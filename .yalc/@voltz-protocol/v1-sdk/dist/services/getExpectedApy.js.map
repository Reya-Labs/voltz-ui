{"version":3,"file":"getExpectedApy.js","sourceRoot":"/","sources":["services/getExpectedApy.ts"],"names":[],"mappings":";;;AAAA,0CAAmD;AAEnD,IAAM,iBAAiB,GAAG,UAAC,KAAa,EAAE,GAAW;IACnD,OAAO,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,+BAAmB,CAAC;AAC7C,CAAC,CAAC;AAEK,IAAM,cAAc,GAAG,UAC5B,OAAe,EAAE,+BAA+B;AAChD,GAAW,EAAE,2BAA2B;AACxC,GAAW,EAAE,iCAAiC;AAC9C,EAAU,EAAE,yBAAyB;AACrC,MAAc,EAAE,iEAAiE;AACjF,YAAoB;IAEpB,2EAA2E;IAC3E,2EAA2E;IAC3E,mFAAmF;IACnF,IAAM,EAAE,GAAG,SAAA,CAAC,CAAC,GAAG,YAAY,CAAC,EAAI,iBAAiB,CAAC,OAAO,EAAE,GAAG,CAAC,CAAA,GAAG,CAAC,CAAC;IAErE,sFAAsF;IACtF,IAAM,GAAG,GAAG,GAAG,GAAG,iBAAiB,CAAC,OAAO,EAAE,GAAG,CAAC,GAAG,IAAI,GAAG,EAAE,GAAG,EAAE,CAAC;IAEnE,gFAAgF;IAChF,IAAM,GAAG,GAAG,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,iBAAiB,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;IAEnE,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACpB,CAAC,CAAC;AApBW,QAAA,cAAc,kBAoBzB","sourcesContent":["import { ONE_YEAR_IN_SECONDS } from '../constants';\n\nconst getAnnualizedTime = (start: number, end: number): number => {\n  return (end - start) / ONE_YEAR_IN_SECONDS;\n};\n\nexport const getExpectedApy = (\n  current: number, // current timestamp in seconds\n  end: number, // end timestamp in seconds\n  uft: number, // unbalanced fixed token balance\n  vt: number, // variable token balance\n  margin: number, // margin until the current timestamp (margin + accrued cashflow)\n  predictedApr: number, // the predicted variable APY between current and end\n): [number, number] => {\n  // (rate[end]/rate[current])^(YEAR / (end-current)) - 1 = APY(current, end)\n  // rate[end]/rate[current] = (APY(current, end) + 1)^((end - current)/YEAR)\n  // rate[end]/rate[current] - 1 = (APY(current, end) + 1)^((end - current)/YEAR) - 1\n  const vf = (1 + predictedApr) ** getAnnualizedTime(current, end) - 1;\n\n  // cashflow = uft * (end - current) / YEAR * 0.01 + vt * (rate[end]/rate[current] - 1)\n  const ecs = uft * getAnnualizedTime(current, end) * 0.01 + vt * vf;\n\n  // PNL = (1 + estimated cashflow / margin so far) ^ (YEAR / (end - current)) - 1\n  const pnl = (ecs / margin) * (1 / getAnnualizedTime(current, end));\n\n  return [pnl, ecs];\n};\n"]}